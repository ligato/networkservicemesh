[build]
  # Directory (relative to root of your repo) that contains the deploy-ready
  # HTML files and assets generated by the build. If a base directory has
  # been specified, include it in the publish directory path.
  publish = "helm-output/"

  command = """export PATH=${PATH}:./helm-output/bin/
               mkdir -p ./helm-output/bin
               # Install helm
               curl -L https://git.io/get_helm.sh | USE_SUDO="false" HELM_INSTALL_DIR="./helm-output/bin" bash
               helm init --client-only
               git remote add upstream https://github.com/networkservicemesh/networkservicemesh.git
               git fetch upstream
               TAGS=(master v0.1.0)
               for TAG in "${TAGS[@]}"
               do
                   git checkout ${TAG}
                   mkdir -p ./helm-output/${TAG}
                   helm repo index ./helm-output/${TAG}
                   helm package -d ./helm-output/${TAG} ./deployments/helm/*
                   helm repo index ./helm-output/${TAG}
               done
               rm -r ./helm-output/bin"""

[[redirects]]
    from = "/*"
    to = "/v0.1.0/:splat"
    status = 200
    force = false
